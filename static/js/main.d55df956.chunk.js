(this["webpackJsonpflood-fill"]=this["webpackJsonpflood-fill"]||[]).push([[0],{264:function(e,t,n){},265:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(90),r=n.n(i),l=(n(98),n(92)),s=n(15),c=n(11),u=n(34),h=n(33),d=n(32),p=n(35),m=n(2),f=n(54),g=(n(264),n(91));function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var C=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).canvasRef=void 0,n.canvasRef=e.canvasRef||o.a.createRef(),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.imgData;return o.a.createElement("canvas",Object.assign({},function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(n,!0).forEach((function(t){Object(g.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);return delete t.imgData,delete t.canvasRef,t}(this.props),{ref:this.canvasRef,width:e.width,height:e.height}))}},{key:"componentDidMount",value:function(){this.renderImgData()}},{key:"componentDidUpdate",value:function(){this.renderImgData()}},{key:"renderImgData",value:function(){this.canvasRef.current.getContext("2d").putImageData(this.props.imgData,0,0)}}]),t}(o.a.Component);var k=function(){function e(t){Object(s.a)(this,e),this.data=void 0,this.dequeueIndex=void 0,this.data=t,this.dequeueIndex=0}return Object(c.a)(e,null,[{key:"empty",value:function(){return new e([])}}]),Object(c.a)(e,[{key:"enqueue",value:function(e){this.data.push(e)}},{key:"dequeue",value:function(){if(this.hasItem()){var e=this.data[this.dequeueIndex];return this.data[this.dequeueIndex]=void 0,this.dequeueIndex++,e}throw new Error("Cannot dequeue an item from an empty queue.")}},{key:"hasItem",value:function(){return this.dequeueIndex<this.data.length}}]),e}(),y=function(){function e(){Object(s.a)(this,e),this.undoStack=void 0,this.redoStack=void 0,this.undoStack=[],this.redoStack=[]}return Object(c.a)(e,null,[{key:"fromCurrent",value:function(t){var n=e.empty();return n.push(t),n}},{key:"empty",value:function(){return new e}}]),Object(c.a)(e,[{key:"undo",value:function(){if(!this.canUndo())throw new Error("Cannot undo nothing.");var e=this.undoStack.pop();return this.redoStack.push(e),e}},{key:"canUndo",value:function(){return this.undoStack.length>1}},{key:"redo",value:function(){if(!this.canRedo())throw new Error("Cannot redo nothing.");var e=this.redoStack.pop();return this.undoStack.push(e),e}},{key:"canRedo",value:function(){return this.redoStack.length>0}},{key:"push",value:function(e){this.undoStack.push(e),this.redoStack=[]}},{key:"current",value:function(){return 0===this.undoStack.length?m.a.none():m.a.some(this.undoStack[this.undoStack.length-1])}},{key:"past",value:function(){return this.undoStack.slice(0,-1)}},{key:"future",value:function(){return this.redoStack.slice().reverse()}},{key:"prev",value:function(){var e=this.past();return e.length>0?m.a.some(e[e.length-1]):m.a.none()}}]),e}();function b(e){return function(e){return new Promise((function(t,n){var a=new FileReader;a.addEventListener("load",(function(){return t(a.result)})),a.addEventListener("error",(function(){return n(a.error)})),a.readAsDataURL(e)}))}(e).then((function(e){return new Promise((function(t,n){var a=document.createElement("img");a.src=e,a.addEventListener("load",(function(){return t(a)})),a.addEventListener("error",n)}))}))}function S(e,t){var n,a=t.startLocation,o=t.replacementColor,i=t.colorComparisonOptions,r=(n=e,new ImageData(n.data.slice(),n.width,n.height)),l=F(o),s=j(r,a),c=function(e,t){var n=t.tolerance,a=t.shouldCompareAlpha,o=n*n;return a?function(t){var n=e.r-t.r,a=e.g-t.g,i=e.b-t.b,r=e.a-t.a;return n*n+a*a+i*i+r*r<=o}:function(t){var n=e.r-t.r,a=e.g-t.g,i=e.b-t.b;return n*n+a*a+i*i<=o}}(s,i);if(E(l,s))return r;var u=e.width,h=e.height;w(r,a,l);var d=k.empty();for(d.enqueue(a);d.hasItem();){var p=d.dequeue();R(p).ifSome((function(e){var t=j(r,e);c(t)&&!E(l,t)&&(w(r,e,l),d.enqueue(e))})),A(p).ifSome((function(e){var t=j(r,e);c(t)&&!E(l,t)&&(w(r,e,l),d.enqueue(e))})),P(p,u).ifSome((function(e){var t=j(r,e);c(t)&&!E(l,t)&&(w(r,e,l),d.enqueue(e))})),O(p,h).ifSome((function(e){var t=j(r,e);c(t)&&!E(l,t)&&(w(r,e,l),d.enqueue(e))}))}return r}function F(e){return{r:e.r,g:e.g,b:e.b,a:Math.floor(255*(void 0===e.a?1:e.a))}}function j(e,t){var n=t.x,a=t.y,o=e.width,i=e.height,r=e.data;if(n>=o)throw new RangeError("X coordinate exceeded image width.");if(a>=i)throw new RangeError("Y coordinate exceeded image height.");var l=4*(a*o+n);return{r:r[l],g:r[l+1],b:r[l+2],a:r[l+3]}}function E(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function w(e,t,n){var a=t.x,o=t.y,i=e.width,r=e.height,l=e.data;if(a>=i)throw new RangeError("X coordinate exceeded image width.");if(o>=r)throw new RangeError("Y coordinate exceeded image height.");var s=4*(o*i+a);l[s]=n.r,l[s+1]=n.g,l[s+2]=n.b,l[s+3]=n.a}function R(e){var t=e.x,n=e.y;return t>0?m.a.some({x:t-1,y:n}):m.a.none()}function A(e){var t=e.x,n=e.y;return n>0?m.a.some({x:t,y:n-1}):m.a.none()}function P(e,t){var n=e.x,a=e.y;return n<t-1?m.a.some({x:n+1,y:a}):m.a.none()}function O(e,t){var n=e.x,a=e.y;return a<t-1?m.a.some({x:n,y:a+1}):m.a.none()}var x=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(u.a)(this,Object(h.a)(t).call(this,e))).mainCanvasRef=void 0,n.snapshotsRef=void 0,n.currentSnapshotRef=void 0,window.app=Object(d.a)(n),n.state={fileName:m.a.none(),shouldBackdropBeCheckered:!0,backdropColorHex:"#222222",history:m.a.none(),replacementColor:m.a.none(),toleranceStr:"0",shouldCompareAlpha:!1,isAdjustingPreviousFill:!1,isSelectingReplacementColorFromCurrentSnapshot:!1,pendingFillUpdate:m.a.none()},n.bindMethods(),n.mainCanvasRef=o.a.createRef(),n.snapshotsRef=o.a.createRef(),n.currentSnapshotRef=o.a.createRef(),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"bindMethods",value:function(){this.onKeyDown=this.onKeyDown.bind(this),this.applyPendingFillUpdate=this.applyPendingFillUpdate.bind(this),this.onFileChange=this.onFileChange.bind(this),this.onReplacementColorChangeComplete=this.onReplacementColorChangeComplete.bind(this),this.onCanvasClick=this.onCanvasClick.bind(this),this.onToleranceChange=this.onToleranceChange.bind(this),this.onShouldCompareAlphaChange=this.onShouldCompareAlphaChange.bind(this),this.onUndoClick=this.onUndoClick.bind(this),this.onRedoClick=this.onRedoClick.bind(this),this.onBackdropColorChangeComplete=this.onBackdropColorChangeComplete.bind(this),this.onShouldBackdropBeCheckeredChange=this.onShouldBackdropBeCheckeredChange.bind(this),this.onStopAdjustingPreviousFillClick=this.onStopAdjustingPreviousFillClick.bind(this),this.onAdjustPreviousFillClick=this.onAdjustPreviousFillClick.bind(this),this.onIsSelectingReplacementColorFromCurrentSnapshotChange=this.onIsSelectingReplacementColorFromCurrentSnapshotChange.bind(this)}},{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.onKeyDown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.onKeyDown)}},{key:"onKeyDown",value:function(e){var t=this;document.activeElement!==document.body||"z"!==e.key.toLowerCase()||!e.ctrlKey&&!e.metaKey||this.state.isAdjustingPreviousFill||(e.preventDefault(),e.shiftKey?this.state.history.ifSome((function(e){e.canRedo()&&t.redo()})):this.state.history.ifSome((function(e){e.canUndo()&&t.undo()})))}},{key:"render",value:function(){var e=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement("header",null,o.a.createElement("h1",null,"Flood fill")),o.a.createElement("main",null,o.a.createElement("div",null,this.state.fileName.match({none:function(){return o.a.createElement("label",null,"Upload an image"," ",o.a.createElement("input",{type:"file",accept:"image/png, image/jpg, image/jpeg, image/gif",onChange:e.onFileChange}))},some:function(t){return e.state.history.match({none:function(){return o.a.createElement("p",null,"Loading ",t,"...")},some:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,"Successfully uploaded ",t),o.a.createElement("label",null,"Choose another image"," ",o.a.createElement("input",{type:"file",accept:"image/png, image/jpg, image/jpeg, image/gif",onChange:e.onFileChange})))}})}})),this.state.replacementColor.match({none:function(){return null},some:function(t){return o.a.createElement("div",null,e.state.isAdjustingPreviousFill?o.a.createElement("div",null,o.a.createElement("h3",null,"Adjusting the previous fill"),e.state.isSelectingReplacementColorFromCurrentSnapshot?o.a.createElement("p",null,'Any changes you make to the fill settings will adjust the previous fill. Since you have the "Select replacment color from image" option checked, clicking on the image will adjust the previous fill\'s replacement color to the clicked color.'):o.a.createElement("p",null,"Any changes you make to the fill settings (including changing the flood start location by clicking on the image) will adjust the previous fill."),o.a.createElement("button",{onClick:e.onStopAdjustingPreviousFillClick},"Stop adjusting")):o.a.createElement("div",null,o.a.createElement("h3",null,"Adjusting next fill"),e.state.isSelectingReplacementColorFromCurrentSnapshot?o.a.createElement("p",null,'Any changes you make to the fill settings will apply to the next fill performed. Since you have the "Select replacment color from image" option checked, clicking on the image will set the next fill\'s replacement color to the clicked color.'):o.a.createElement("p",null,"Any changes you make to the fill settings will apply to the next fill performed. Clicking on the image will cause a new fill to be performed."),o.a.createElement("button",{onClick:e.onAdjustPreviousFillClick,disabled:e.state.history.andThen((function(e){return e.current().andThen((function(e){return e.fill}))})).isNone()},"Adjust previous fill")),o.a.createElement("div",null,o.a.createElement("label",null,"Select replacement color from image:"," ",o.a.createElement("input",{type:"checkbox",checked:e.state.isSelectingReplacementColorFromCurrentSnapshot,onChange:e.onIsSelectingReplacementColorFromCurrentSnapshotChange}))),o.a.createElement("div",null,o.a.createElement("label",null,"Replacement color:",o.a.createElement(f.SketchPicker,{color:t,onChangeComplete:e.onReplacementColorChangeComplete}))),o.a.createElement("section",null,o.a.createElement("h3",null,"Backdrop"),o.a.createElement("label",null,"Use checkerboard:"," ",o.a.createElement("input",{type:"checkbox",checked:e.state.shouldBackdropBeCheckered,onChange:e.onShouldBackdropBeCheckeredChange}),!e.state.shouldBackdropBeCheckered&&o.a.createElement("label",null,"Color:",o.a.createElement(f.SketchPicker,{disableAlpha:!0,color:e.state.backdropColorHex,onChangeComplete:e.onBackdropColorChangeComplete})))),o.a.createElement("label",null,"Tolerance:"," ",o.a.createElement("input",{type:"number",value:e.state.toleranceStr,onChange:e.onToleranceChange}),o.a.createElement("input",{type:"range",value:e.state.toleranceStr,onChange:e.onToleranceChange,min:0,max:Math.ceil(D(e.state.shouldCompareAlpha))})),o.a.createElement("label",null,"Compare alpha values:"," ",o.a.createElement("input",{type:"checkbox",checked:e.state.shouldCompareAlpha,onChange:e.onShouldCompareAlphaChange})))}}),this.state.history.andThen((function(e){return e.current()})).match({none:function(){return null},some:function(t){return o.a.createElement("div",Object.assign({className:"MainCanvasContainer"+(e.state.shouldBackdropBeCheckered?" Checkerboard":"")},e.state.shouldBackdropBeCheckered?{}:{style:{backgroundColor:e.state.backdropColorHex}}),o.a.createElement(C,{imgData:t.imgDataAfterFill,canvasRef:e.mainCanvasRef,className:"MainCanvas",onClick:e.onCanvasClick}))}}),this.state.history.match({none:function(){return null},some:function(t){return o.a.createElement("div",null,o.a.createElement("h3",null,"History"),e.state.isAdjustingPreviousFill&&o.a.createElement("p",null,"You cannot undo or redo because you are adjusting the previous fill. To be able to undo and redo, stop adjusting the previous fill."),o.a.createElement("button",{onClick:e.onUndoClick,disabled:!t.canUndo()||e.state.isAdjustingPreviousFill},"Undo"),o.a.createElement("button",{onClick:e.onRedoClick,disabled:!t.canRedo()||e.state.isAdjustingPreviousFill},"Redo"),!e.state.isAdjustingPreviousFill&&o.a.createElement("p",null,"You can also Undo by pressing ",o.a.createElement("kbd",null,"Ctrl-Z")," or"," ",o.a.createElement("kbd",null,"Cmd-Z")," and Redo by pressing"," ",o.a.createElement("kbd",null,"Ctrl-Shift-Z")," or ",o.a.createElement("kbd",null,"Cmd-Shift-Z"),"."),o.a.createElement("div",{className:"Snapshots",ref:e.snapshotsRef},t.past().map((function(e,t){return o.a.createElement(C,{key:t,imgData:e.imgDataAfterFill,className:"HistorySnapshot NonFinalSnapshot"})})),t.current().match({none:function(){return null},some:function(n){return o.a.createElement(C,{imgData:n.imgDataAfterFill,className:"HistorySnapshot CurrentSnapshot"+(t.future().length>0?" NonFinalSnapshot":""),canvasRef:e.currentSnapshotRef})}}),t.future().map((function(e,t,n){var a=n.length;return o.a.createElement(C,{key:t,imgData:e.imgDataAfterFill,className:"HistorySnapshot"+(t<a-1?" NonFinalSnapshot":"")})}))))}})))}},{key:"onFileChange",value:function(e){var t=this,n=e.target.files;if(null!==n){var a=n[0];a instanceof File&&/\.(jpe?g|png|gif)$/i.test(a.name)&&(this.setState({fileName:m.a.some(a.name),history:m.a.none(),replacementColor:this.state.replacementColor.or(m.a.some({r:0,g:0,b:0,a:0})),isAdjustingPreviousFill:!1,pendingFillUpdate:m.a.none()}),b(a).then((function(e){var n=function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");return n.drawImage(e,0,0),n.getImageData(0,0,t.width,t.height)}(e),a={fill:m.a.none(),imgDataAfterFill:n};t.setState({history:m.a.some(y.fromCurrent(a))})})))}}},{key:"onReplacementColorChangeComplete",value:function(e){var t=F(e.rgb);this.setState({replacementColor:m.a.some(t)}),this.state.isAdjustingPreviousFill&&this.adjustPreviousFill({replacementColor:t})}},{key:"onCanvasClick",value:function(e){var t=this;m.a.all([this.state.replacementColor,this.state.history,this.state.history.andThen((function(e){return e.current()}))]).ifSome((function(n){var a=Object(l.a)(n,3),o=a[0],i=a[1],r=a[2],s=e.clientX,c=e.clientY,u=t.mainCanvasRef.current,h=r.imgDataAfterFill,d=u.getBoundingClientRect(),p={x:Math.round(s-d.left),y:Math.round(c-d.top)};if(!E(o,j(h,p)))if(t.state.isAdjustingPreviousFill)if(t.state.isSelectingReplacementColorFromCurrentSnapshot){var f=j(h,p);t.adjustPreviousFill({replacementColor:f})}else t.adjustPreviousFill({startLocation:p});else if(t.state.isSelectingReplacementColorFromCurrentSnapshot){var g=j(h,p);t.setState({replacementColor:m.a.some(g)})}else{var v={startLocation:p,replacementColor:o,colorComparisonOptions:{tolerance:parseInt(t.state.toleranceStr,10),shouldCompareAlpha:t.state.shouldCompareAlpha}},C=S(h,v),k={fill:m.a.some(v),imgDataAfterFill:C};i.push(k),t.forceUpdate()}}))}},{key:"onToleranceChange",value:function(e){var t=e.target.value;this.setState({toleranceStr:t}),this.state.isAdjustingPreviousFill&&this.adjustPreviousFill({colorComparisonOptions:{tolerance:parseInt(t,10)}})}},{key:"onShouldCompareAlphaChange",value:function(e){var t=e.target.checked;this.setState({shouldCompareAlpha:t}),this.state.isAdjustingPreviousFill&&("slider"===e.target.type?this.debouncedAdjustPreviousFill({colorComparisonOptions:{shouldCompareAlpha:t}}):this.adjustPreviousFill({colorComparisonOptions:{shouldCompareAlpha:t}}))}},{key:"debouncedAdjustPreviousFill",value:function(e){var t=this;this.state.pendingFillUpdate.ifNone((function(){t.setState({pendingFillUpdate:m.a.some(e)}),requestAnimationFrame(t.applyPendingFillUpdate)}))}},{key:"applyPendingFillUpdate",value:function(){var e=this;this.state.pendingFillUpdate.ifSome((function(t){e.clearPendingFillUpdate(),e.adjustPreviousFill(t)}))}},{key:"clearPendingFillUpdate",value:function(){this.setState({pendingFillUpdate:m.a.none()})}},{key:"adjustPreviousFill",value:function(e){this.clearPendingFillUpdate();var t=this.state.history.expect("Cannot call adjustPreviousFill if there is no history"),n=t.current().expect("Cannot call adjustPreviousFill if there is no current snapshot"),a=t.prev().expect("Cannot call adjustPreviousFill if there is no previous snapshot"),o=function(e,t){var n=t.colorComparisonOptions&&t.colorComparisonOptions.tolerance,a=t.colorComparisonOptions&&t.colorComparisonOptions.shouldCompareAlpha;return{startLocation:t.startLocation||e.startLocation,replacementColor:t.replacementColor||e.replacementColor,colorComparisonOptions:{tolerance:void 0!==n?n:e.colorComparisonOptions.tolerance,shouldCompareAlpha:void 0!==a?a:e.colorComparisonOptions.shouldCompareAlpha}}}(n.fill.expect("Cannot call adjustPreviousFill if the current snapshot was not created by flood-fill"),e);n.fill=m.a.some(o),n.imgDataAfterFill=S(a.imgDataAfterFill,o),this.forceUpdate()}},{key:"onUndoClick",value:function(){this.undo()}},{key:"undo",value:function(){var e=this;this.state.history.expect("Cannot call onUndoClick if history is none").undo(),this.forceUpdate((function(){e.scrollHistoryToCurrentSnapshot()}))}},{key:"onRedoClick",value:function(){this.redo()}},{key:"redo",value:function(){var e=this;this.state.history.expect("Cannot call onRedoClick if history is none").redo(),this.forceUpdate((function(){e.scrollHistoryToCurrentSnapshot()}))}},{key:"onBackdropColorChangeComplete",value:function(e){this.setState({backdropColorHex:e.hex})}},{key:"onShouldBackdropBeCheckeredChange",value:function(e){this.setState({shouldBackdropBeCheckered:e.target.checked})}},{key:"scrollHistoryToCurrentSnapshot",value:function(){var e=this.currentSnapshotRef.current;if(null!==e){var t=this.snapshotsRef.current,n=t.getBoundingClientRect().width,a=e.getBoundingClientRect().right;t.scroll(a+t.scrollLeft-n,0)}}},{key:"onStopAdjustingPreviousFillClick",value:function(){this.setState({isAdjustingPreviousFill:!1})}},{key:"onAdjustPreviousFillClick",value:function(){this.setState({isAdjustingPreviousFill:!0})}},{key:"onIsSelectingReplacementColorFromCurrentSnapshotChange",value:function(e){this.setState({isSelectingReplacementColorFromCurrentSnapshot:e.target.checked})}}]),t}(o.a.Component);function D(e){return e?Math.hypot(255,255,255,255):Math.hypot(255,255,255)}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(x,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},93:function(e,t,n){e.exports=n(265)},98:function(e,t,n){}},[[93,1,2]]]);
//# sourceMappingURL=main.d55df956.chunk.js.map