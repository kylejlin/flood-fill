(this["webpackJsonpflood-fill"]=this["webpackJsonpflood-fill"]||[]).push([[0],{264:function(e,t,n){},265:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(89),i=n.n(o),u=(n(98),n(92)),c=n(15),l=n(11),s=n(34),h=n(33),d=n(32),m=n(35),f=n(3),v=n(90),p=(n(264),n(91));function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var C=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(h.a)(t).call(this,e))).canvasRef=void 0,n.canvasRef=e.canvasRef||r.a.createRef(),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.imgData;return r.a.createElement("canvas",Object.assign({},function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(n,!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e);return delete t.imgData,delete t.canvasRef,t}(this.props),{ref:this.canvasRef,width:e.width,height:e.height}))}},{key:"componentDidMount",value:function(){this.renderImgData()}},{key:"componentDidUpdate",value:function(){this.renderImgData()}},{key:"renderImgData",value:function(){this.canvasRef.current.getContext("2d").putImageData(this.props.imgData,0,0)}}]),t}(r.a.Component);var y=function(){function e(t){Object(c.a)(this,e),this.data=void 0,this.dequeueIndex=void 0,this.data=t,this.dequeueIndex=0}return Object(l.a)(e,null,[{key:"empty",value:function(){return new e([])}}]),Object(l.a)(e,[{key:"enqueue",value:function(e){this.data.push(e)}},{key:"dequeue",value:function(){if(this.hasItem()){var e=this.data[this.dequeueIndex];return this.data[this.dequeueIndex]=void 0,this.dequeueIndex++,e}throw new Error("Cannot dequeue an item from an empty queue.")}},{key:"hasItem",value:function(){return this.dequeueIndex<this.data.length}}]),e}(),k=function(){function e(){Object(c.a)(this,e),this.undoStack=void 0,this.redoStack=void 0,this.undoStack=[],this.redoStack=[]}return Object(l.a)(e,null,[{key:"fromCurrent",value:function(t){var n=e.empty();return n.push(t),n}},{key:"empty",value:function(){return new e}}]),Object(l.a)(e,[{key:"undo",value:function(){if(!this.canUndo())throw new Error("Cannot undo nothing.");var e=this.undoStack.pop();return this.redoStack.push(e),e}},{key:"canUndo",value:function(){return this.undoStack.length>1}},{key:"redo",value:function(){if(!this.canRedo())throw new Error("Cannot redo nothing.");var e=this.redoStack.pop();return this.undoStack.push(e),e}},{key:"canRedo",value:function(){return this.redoStack.length>0}},{key:"push",value:function(e){this.undoStack.push(e),this.redoStack=[]}},{key:"current",value:function(){return 0===this.undoStack.length?f.a.none():f.a.some(this.undoStack[this.undoStack.length-1])}},{key:"past",value:function(){return this.undoStack.slice(0,-1)}},{key:"future",value:function(){return this.redoStack.slice().reverse()}}]),e}();function b(e){return function(e){return new Promise((function(t,n){var a=new FileReader;a.addEventListener("load",(function(){return t(a.result)})),a.addEventListener("error",(function(){return n(a.error)})),a.readAsDataURL(e)}))}(e).then((function(e){return new Promise((function(t,n){var a=document.createElement("img");a.src=e,a.addEventListener("load",(function(){return t(a)})),a.addEventListener("error",n)}))}))}function w(e,t,n,a){var r,o=(r=e,new ImageData(r.data.slice(),r.width,r.height)),i=E(n),u=S(o,t),c=function(e,t){var n=t.tolerance,a=t.shouldCompareAlpha,r=n*n;return a?function(t){var n=e.r-t.r,a=e.g-t.g,o=e.b-t.b,i=e.a-t.a;return n*n+a*a+o*o+i*i<=r}:function(t){var n=e.r-t.r,a=e.g-t.g,o=e.b-t.b;return n*n+a*a+o*o<=r}}(u,a);if(O(i,u))return o;var l=e.width,s=e.height;R(o,t,i);var h=y.empty();for(h.enqueue(t);h.hasItem();){var d=h.dequeue();j(d).ifSome((function(e){var t=S(o,e);c(t)&&!O(i,t)&&(R(o,e,i),h.enqueue(e))})),x(d).ifSome((function(e){var t=S(o,e);c(t)&&!O(i,t)&&(R(o,e,i),h.enqueue(e))})),I(d,l).ifSome((function(e){var t=S(o,e);c(t)&&!O(i,t)&&(R(o,e,i),h.enqueue(e))})),D(d,s).ifSome((function(e){var t=S(o,e);c(t)&&!O(i,t)&&(R(o,e,i),h.enqueue(e))}))}return o}function E(e){return{r:e.r,g:e.g,b:e.b,a:Math.floor(255*(void 0===e.a?1:e.a))}}function S(e,t){var n=t.x,a=t.y,r=e.width,o=e.height,i=e.data;if(n>=r)throw new RangeError("X coordinate exceeded image width.");if(a>=o)throw new RangeError("Y coordinate exceeded image height.");var u=4*(a*r+n);return{r:i[u],g:i[u+1],b:i[u+2],a:i[u+3]}}function O(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function R(e,t,n){var a=t.x,r=t.y,o=e.width,i=e.height,u=e.data;if(a>=o)throw new RangeError("X coordinate exceeded image width.");if(r>=i)throw new RangeError("Y coordinate exceeded image height.");var c=4*(r*o+a);u[c]=n.r,u[c+1]=n.g,u[c+2]=n.b,u[c+3]=n.a}function j(e){var t=e.x,n=e.y;return t>0?f.a.some({x:t-1,y:n}):f.a.none()}function x(e){var t=e.x,n=e.y;return n>0?f.a.some({x:t,y:n-1}):f.a.none()}function I(e,t){var n=e.x,a=e.y;return n<t-1?f.a.some({x:n+1,y:a}):f.a.none()}function D(e,t){var n=e.x,a=e.y;return a<t-1?f.a.some({x:n,y:a+1}):f.a.none()}var q=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(h.a)(t).call(this,e))).mainCanvasRef=void 0,window.app=Object(d.a)(n),n.state={originalImg:f.a.none(),fileName:f.a.none(),history:f.a.none(),replacementColor:f.a.none(),toleranceStr:"0",shouldCompareAlpha:!1},n.bindMethods(),n.mainCanvasRef=r.a.createRef(),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"bindMethods",value:function(){this.onFileChange=this.onFileChange.bind(this),this.onReplacementColorChangeComplete=this.onReplacementColorChangeComplete.bind(this),this.onCanvasClick=this.onCanvasClick.bind(this),this.onToleranceChange=this.onToleranceChange.bind(this),this.onShouldCompareAlphaChange=this.onShouldCompareAlphaChange.bind(this),this.onUndoClick=this.onUndoClick.bind(this),this.onRedoClick=this.onRedoClick.bind(this)}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("header",null,r.a.createElement("h1",null,"Flood fill")),r.a.createElement("main",null,r.a.createElement("div",null,this.state.fileName.match({none:function(){return r.a.createElement("label",null,"Upload an image"," ",r.a.createElement("input",{type:"file",accept:"image/png, image/jpg, image/jpeg, image/gif",onChange:e.onFileChange}))},some:function(e){return r.a.createElement("p",null,"Successfully uploaded ",e)}})),this.state.replacementColor.match({none:function(){return null},some:function(t){return r.a.createElement("div",null,r.a.createElement("label",null,"Replacement color:",r.a.createElement(v.SketchPicker,{color:t,onChangeComplete:e.onReplacementColorChangeComplete})),r.a.createElement("label",null,"Tolerance:"," ",r.a.createElement("input",{type:"number",value:e.state.toleranceStr,onChange:e.onToleranceChange})),r.a.createElement("label",null,"Compare alpha values:"," ",r.a.createElement("input",{type:"checkbox",checked:e.state.shouldCompareAlpha,onChange:e.onShouldCompareAlphaChange})))}}),this.state.history.andThen((function(e){return e.current()})).match({none:function(){return null},some:function(t){return r.a.createElement("div",{className:"MainCanvasContainer"},r.a.createElement(C,{imgData:t,canvasRef:e.mainCanvasRef,className:"MainCanvas",onClick:e.onCanvasClick}))}}),this.state.history.match({none:function(){return null},some:function(t){return r.a.createElement("div",null,r.a.createElement("h3",null,"History"),r.a.createElement("div",null,r.a.createElement("h4",null,"Past"),r.a.createElement("button",{onClick:e.onUndoClick,disabled:!t.canUndo()},"Undo"),r.a.createElement("div",null,t.past().map((function(e,t,n){var a=n.length;return r.a.createElement(C,{key:t,imgData:e,className:"HistorySnapshot"+(t<a-1?" NonFinalSnapshot":"")})})))),r.a.createElement("div",null,r.a.createElement("h4",null,"Future"),r.a.createElement("button",{onClick:e.onRedoClick,disabled:!t.canRedo()},"Redo"),r.a.createElement("div",null,t.future().map((function(e,t,n){var a=n.length;return r.a.createElement(C,{key:t,imgData:e,className:"HistorySnapshot"+(t<a-1?" NonFinalSnapshot":"")})})))))}})))}},{key:"onFileChange",value:function(e){var t=this,n=e.target.files;if(null!==n){var a=n[0];a instanceof File&&/\.(jpe?g|png|gif)$/i.test(a.name)&&b(a).then((function(e){var n=function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");return n.drawImage(e,0,0),n.getImageData(0,0,t.width,t.height)}(e);t.setState({originalImg:f.a.some(e),fileName:f.a.some(a.name),history:f.a.some(k.fromCurrent(n)),replacementColor:f.a.some({r:0,g:0,b:0,a:0})})}))}}},{key:"onReplacementColorChangeComplete",value:function(e){this.setState({replacementColor:f.a.some(e.rgb)})}},{key:"onCanvasClick",value:function(e){var t=this;f.a.all([this.state.replacementColor,this.state.history,this.state.history.andThen((function(e){return e.current()}))]).ifSome((function(n){var a=Object(u.a)(n,3),r=a[0],o=a[1],i=a[2],c=e.clientX,l=e.clientY,s=i,h=t.mainCanvasRef.current.getBoundingClientRect(),d={x:Math.round(c-h.left),y:Math.round(l-h.top)};if(m=s,f=d,!O(E(r),S(m,f))){var m,f,v=w(s,d,r,{tolerance:parseInt(t.state.toleranceStr,10),shouldCompareAlpha:t.state.shouldCompareAlpha});o.push(v),t.forceUpdate()}}))}},{key:"onToleranceChange",value:function(e){this.setState({toleranceStr:e.target.value})}},{key:"onShouldCompareAlphaChange",value:function(e){this.setState({shouldCompareAlpha:e.target.checked})}},{key:"onUndoClick",value:function(){this.state.history.expect("Cannot call onUndoClick if history is none").undo(),this.forceUpdate()}},{key:"onRedoClick",value:function(){this.state.history.expect("Cannot call onRedoClick if history is none").redo(),this.forceUpdate()}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},93:function(e,t,n){e.exports=n(265)},98:function(e,t,n){}},[[93,1,2]]]);
//# sourceMappingURL=main.7b0b7996.chunk.js.map